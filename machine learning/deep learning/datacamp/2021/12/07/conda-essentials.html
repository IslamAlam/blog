<h1 id="conda-essentials">Conda Essentials</h1>

<p>This is the memo of the 20th course of ‘Data Scientist with Python’ track.</p>

<p><strong>You can find the original course
 <a href="https://www.datacamp.com/courses/conda-essentials">HERE</a></strong>
 .</p>

<hr />

<h1 id="1-installing-packages"><strong>1. Installing Packages</strong></h1>
<hr />

<p>####
<strong>What are packages and why are they needed?</strong></p>

<p>Conda packages are files containing a bundle of resources: usually libraries and executables, but not always. In principle, Conda packages can include data, images, notebooks, or other assets. The command-line tool
 <code class="language-plaintext highlighter-rouge">conda</code>
 is used to install, remove and examine packages; other tools such as the GUI
 <em>Anaconda Navigator</em>
 also expose the same capabilities. This course focuses on the
 <code class="language-plaintext highlighter-rouge">conda</code>
 tool itself (you’ll see use cases other than package management in later chapters).</p>

<p>Conda packages are most widely used with Python, but that’s not all. Nothing about the Conda package format or the
 <code class="language-plaintext highlighter-rouge">conda</code>
 tool itself assumes any specific programming language. Conda packages can also be used for bundling libraries in other languages (like R, Scala, Julia, etc.) or simply for distributing pure binary executables generated from
 <em>any</em>
 programming language.</p>

<p>One of the powerful aspects of
 <code class="language-plaintext highlighter-rouge">conda</code>
 —both the tool and the package format—is that dependencies are taken care of. That is, when you install any Conda package, any other packages needed get installed automatically. Tracking and determining software dependencies is a hard problem that package managers like Conda are designed to solve.</p>

<p>A Conda package, then, is a file containing all files needed to make a given program execute correctly on a given system. Moreover, a Conda package can contain binary artifacts specific to a particular platform or operating system. Most packages (and their dependencies) are available for Windows (
 <code class="language-plaintext highlighter-rouge">win-32</code>
 or
 <code class="language-plaintext highlighter-rouge">win-64</code>
 ), for OSX (
 <code class="language-plaintext highlighter-rouge">osx-64</code>
 ), and for Linux (
 <code class="language-plaintext highlighter-rouge">linux-32</code>
 or
 <code class="language-plaintext highlighter-rouge">linux-64</code>
 ). A small number of Conda packages are available for more specialized platforms (e.g., Raspberry Pi 2 or POWER8 LE). As a user, you do not need to specify the platform since Conda will simply choose the Conda package appropriate for the platform you are using.</p>

<p>Conda packages’ features</p>

<ul>
  <li>The Conda package format is programming-language and asset-type independent.</li>
  <li>Packages contain a description of all dependencies, all of which are installed together.</li>
  <li>The tool conda can be used to install, examine, or remove packages from a working system.</li>
  <li>Other GUI or web-based tools can be used as a wrapper for the tool conda for package management.</li>
</ul>

<p>####
<strong>determine version of
 <code class="language-plaintext highlighter-rouge">conda</code></strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda --version
conda 4.7.5

</code></pre></div></div>

<p>####
<strong>Install a conda package (I)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda install --help | grep package_spec
                     [package_spec [package_spec ...]]
  package_spec          Packages to install or update in the conda environment.

</code></pre></div></div>

<p>####
<strong>Install a conda package (II)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda install cytoolz

</code></pre></div></div>

<p>####
<strong>semantic versioning</strong></p>

<p>Most Conda packages use a system called
 <a href="https://semver.org/"><em>semantic versioning</em></a>
 to identify distinct versions of a software package unambiguously.</p>

<p>Under
 <a href="https://semver.org/">semantic versioning</a>
 , software is labeled with a three-part version identifier of the form
 <code class="language-plaintext highlighter-rouge">MAJOR.MINOR.PATCH</code>
 ; the label components are non-negative integers separated by periods. Assuming all software starts at version
 <code class="language-plaintext highlighter-rouge">0.0.0</code></p>

<p>####
<strong>package version: conda list</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda list
# packages in environment at /home/repl/miniconda:
## Name                    Version                   Build  Channel
_libgcc_mutex             0.1                        main
anaconda-client           1.7.2                    py36_0
anaconda-project          0.8.3                      py_0
...

</code></pre></div></div>

<p>####
<strong>Install a specific version of a package (I)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
conda install foo-lib=13 # only sepecify MAJOR version
conda install foo-lib=12.3 # sepecify MAJOR and MINOR version
conda install foo-lib=14.3.2 # sepecify MAJOR, MINOR and PATCH

</code></pre></div></div>

<p>####
<strong>Install a specific version of a package (II)</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># install 1.0, 1.4 or 1.4.1b2</span>
conda <span class="nb">install</span> <span class="s1">'bar-lib=1.0|1.4*'</span>

<span class="c"># install later than version 1.3.4, or earlier than version 1.1</span>
conda <span class="nb">install</span> <span class="s1">'bar-lib&gt;=1.3.4,&lt;1.1'</span>

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda install 'attrs&gt;16,&lt;17.3'
Collecting package metadata (current_repodata.json): done
Solving environment: failedCollecting package metadata (repodata.json): done
Solving environment: done

## Package Plan ##

  environment location: /home/repl/miniconda

  added / updated specs:
    - attrs[version='&gt;16,&lt;17.3']


The following packages will be downloaded:

    package                    |            build
    ---------------------------|-----------------
    attrs-17.2.0               |   py36h8d46266_0          34 KB
    ------------------------------------------------------------
                                           Total:          34 KB

</code></pre></div></div>

<p>####
<strong>Update a conda package</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
conda update PKGNAME
conda update foo bar blob

(base) $ conda update pandas

</code></pre></div></div>

<p>####
<strong>Remove a conda package</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
conda remove PKGNAME

</code></pre></div></div>

<p>####
<strong>Search for available package versions</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
conda search PKGNAME

</code></pre></div></div>

<p>####
<strong>Find dependencies for a package version</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
conda search 'PKGNAME=1.13.1=py36*' --info


(base) $ conda search 'numpy=1.13.1=py36*' --info
...
...
dependencies:
  - libgcc-ng &gt;=7.2.0
  - libgfortran-ng &gt;=7.2.0,&lt;8.0a0
  - python &gt;=3.6,&lt;3.7.0a0
  - mkl &gt;=2018.0.0,&lt;2019.0a0
  - blas * mkl

</code></pre></div></div>

<hr />

<h1 id="2-utilizing-channels"><strong>2. Utilizing Channels</strong></h1>
<hr />

<p>####
<strong>Channels and why are they needed?</strong></p>

<p>All Conda packages we’ve seen so far were published on the
 <code class="language-plaintext highlighter-rouge">main</code>
 or
 <code class="language-plaintext highlighter-rouge">default</code>
 channel of Anaconda Cloud. A
 <em>Conda channel</em>
 is an identifier of a path (e.g., as in a web address) from which Conda packages can be obtained.</p>

<p>Channels are a means for a user to publish packages independently.</p>

<p>####
<strong>Searching within channels</strong></p>

<p><strong>conda search -c channel_name –platform linux-64 package_name</strong></p>

<p>-c, –channel: search in channel</p>

<p>–override-channels: used to prevent searching on default channels</p>

<p>–platform: is used to select a platform</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda search --channel davidmertz --override-channels --platform linux-64
Loading channels: done
# Name                       Version           Build  Channel
accelerate                     2.2.0     np110py27_2  davidmertz
accelerate                     2.2.0     np110py35_2  davidmertz
accelerate-dldist                0.1     np110py27_1  davidmertz
...
textadapter                    2.0.0          py36_0  davidmertz


(base) $ conda search -c conda-forge -c sseefeld -c gbrener --platform win-64 textadapter
Loading channels: done
# Name                       Version           Build  Channel
textadapter                    2.0.0          py27_0  conda-forge
textadapter                    2.0.0          py27_0  sseefeld
textadapter                    2.0.0 py27h0ff66c2_1000  conda-forge
...
textadapter                    2.0.0          py36_0  sseefeld

</code></pre></div></div>

<p>####
<strong>Searching package: anaconda search pck_name</strong></p>

<p>anaconda, not conda</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ anaconda search textadapter
Using Anaconda Cloud api site https://api.anaconda.orgRun 'anaconda show &lt;USER/PACKAGE&gt;' to get more details:
Packages:     Name                      |  Version | Package Types   | Platforms
     ------------------------- |   ------ | --------------- | ---------------     DavidMertz/textadapter    |    2.0.0 | conda           | linux-64, osx-64
     conda-forge/textadapter   |    2.0.0 | conda           | linux-64, win-32, osx-64, win-64     gbrener/textadapter       |    2.0.0 | conda           | linux-64, osx-64
                                          : python interface Amazon S3, and large data files     sseefeld/textadapter      |    2.0.0 | conda           | win-64
                                          : python interface Amazon S3, and large data files     stuarteberg/textadapter   |    2.0.0 | conda           | osx-64
Found 5 packages

</code></pre></div></div>

<p>####
<strong>conda-forge channel</strong></p>

<p>The default channel on Anaconda Cloud is curated by Anaconda Inc., but another channel called
 <code class="language-plaintext highlighter-rouge">conda-forge</code>
 also has a special status. This channel does not operate any differently than other channels, whether those others are associated with an individual or organization, but it acts as a kind of “community curation” of relatively well-vetted packages.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda search -c conda-forge | grep conda-forge | wc -l
87113

</code></pre></div></div>

<p>About 90,000 packages in conda-forge channel.</p>

<p>####
<strong>Installing from a channel</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
conda install --channel my-organization the-package

</code></pre></div></div>

<hr />

<h1 id="3-working-with-environments"><strong>3. Working with Environments</strong></h1>
<hr />

<p>####
<strong>Environments and why are they needed?</strong></p>

<p>Conda
 <em>environments</em>
 allow multiple incompatible versions of the same (software) package to coexist on your system. An
 <em>environment</em>
 is simply a file path containing a collection of mutually compatible packages. By isolating distinct versions of a given package (and their dependencies) in distinct environments, those versions are all available to work on particular projects or tasks.</p>

<p>Conda environments allow for flexible version management of packages.</p>

<p>####
<strong>Which environment am I using?</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(course-project) $ conda env list
# conda environments:
#
_tmp                     /.conda/envs/_tmp
course-env               /.conda/envs/course-env
course-project        *  /.conda/envs/course-project
pd-2015                  /.conda/envs/pd-2015
py1.0                    /.conda/envs/py1.0
test-env                 /.conda/envs/test-env
base                     /home/repl/miniconda

</code></pre></div></div>

<p>####
<strong>What packages are installed in an environment? (I)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda list 'numpy|pandas'
# packages in environment at /home/repl/miniconda:
## Name                    Version                   Build  Channel
numpy                     1.16.0           py36h7e9f1db_1
numpy-base                1.16.0           py36hde5b4d6_1
pandas                    0.22.0           py36hf484d3e_0

</code></pre></div></div>

<p>####
<strong>What packages are installed in an environment? (II)</strong></p>

<p>conda list</p>

<p>-n, –name: env_name</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda list -n pd-2015 'numpy|pandas'
# packages in environment at /.conda/envs/pd-2015:
## Name                    Version                   Build  Channel
numpy                     1.16.4           py36h7e9f1db_0
numpy-base                1.16.4           py36hde5b4d6_0
pandas                    0.22.0           py36hf484d3e_0

</code></pre></div></div>

<p>####
<strong>Switch between environments</strong></p>

<p>To
 <em>activate</em>
 an environment, you simply use
 <code class="language-plaintext highlighter-rouge">conda activate ENVNAME</code>
 . To
 <em>deactivate</em>
 an environment, you use
 <code class="language-plaintext highlighter-rouge">conda deactivate</code>
 , which returns you to the root/base environment.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda activate course-env
(course-env) $ conda activate pd-2015
(pd-2015) $ conda deactivate
(course-env) $ conda env list
# conda environments:
#
_tmp                     /.conda/envs/_tmp
course-env            *  /.conda/envs/course-env
course-project           /.conda/envs/course-project
pd-2015                  /.conda/envs/pd-2015
py1.0                    /.conda/envs/py1.0
test-env                 /.conda/envs/test-env
base                     /home/repl/miniconda

</code></pre></div></div>

<p>####
<strong>Remove an environment</strong></p>

<p>conda env remove –name ENVNAME</p>

<p>-n, –name</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda env remove -n deprecated

Remove all packages in environment /.conda/envs/deprecated:

</code></pre></div></div>

<p>####
<strong>Create a new environment</strong></p>

<p>conda create –name recent-pd python=3.6 pandas=0.22 scipy statsmodels</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda create -n conda-essentials attrs=19.1.0 cytoolz
Collecting package metadata (current_repodata.json): done
Solving environment: done
...

</code></pre></div></div>

<p>####
<strong>Export an environment</strong></p>

<p>conda env export</p>

<p>-n, –name: export an environment other than the active one</p>

<p>-f, –file: output the environment specification to a file</p>

<p>By convention, the name environment.yml is used for environment, but any name can be used (but the extension .yml is strongly encouraged).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda env export -n course-env -f course-env.yml

(base) $ head course-env.yml
name: course-env
channels:
  - defaults
dependencies:
  - _libgcc_mutex=0.1=main
  - blas=1.0=mkl
  - ca-certificates=2019.5.15=0
  - certifi=2019.6.16=py36_0
  - intel-openmp=2019.4=243
  - libedit=3.1.20181209=hc058e9b_0

</code></pre></div></div>

<p>####
<strong>Create an environment from a shared specification</strong></p>

<p>conda env create -n env_name -f file-name.yml</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ conda env create --file environment.yml
Collecting package metadata (repodata.json): done
Solving environment: done

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ cat shared-config.yml
name: functional-data
channels:
  - defaults
dependencies:
  - python=3
  - cytoolz
  - attrs

(base) $ conda env create -f shared-config.yml

</code></pre></div></div>

<hr />

<h1 id="4-case-study-on-using-environments"><strong>4. Case Study on Using Environments</strong></h1>
<hr />

<p>####
<strong>Compatibility with different versions</strong></p>

<p>A common case for using environments is in developing scripts or Jupyter notebooks that rely on particular software versions for their functionality. Over time, the underlying tools might change, making updating the scripts worthwhile. Being able to switch between environments with different versions of the underlying packages installed makes this development process much easier.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ cat weekly_humidity.py# weekly_humidity.py
# rolling mean of humidity
import pandas as pd
df = pd.read_csv('pittsburgh2015_celsius.csv')
humidity = df['Mean Humidity']
print(pd.rolling_mean(humidity, 7).tail(5))

(base) $ python weekly_humidity.py
weekly_humidity.py:6: FutureWarning: pd.rolling_mean is deprecated for Series and will be removed in a future version, replace with
        Series.rolling(window=7,center=False).mean()
  print(pd.rolling_mean(humidity, 7).tail(5))
360    77.000000361    80.428571362    78.857143
363    78.285714
364    78.714286Name: Mean Humidity, dtype: float64

(base) $ conda activate pd-2015

(pd-2015) $ python weekly_humidity.py
360    77.000000
361    80.428571
362    78.857143
363    78.285714
364    78.714286
Name: Mean Humidity, dtype: float64

</code></pre></div></div>

<p><strong>FutureWarning is not present in pd-2015 environment.</strong></p>

<p>####
<strong>Updating a script</strong></p>

<p>Update the script so the FutureWarning is gone.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
(base) $ nano weekly_humidity.py

(base) $ cat weekly_humidity.py
# weekly_humidity.py
# rolling mean of humidity
import pandas as pd
df = pd.read_csv('pittsburgh2015_celsius.csv')
humidity = df['Mean Humidity']
print(humidity.rolling(7).mean().tail(5))

(base) $ python weekly_humidity.py
360    77.000000
361    80.428571
362    78.857143
363    78.285714
364    78.714286
Name: Mean Humidity, dtype: float64

(base) $ conda activate pd-2015
(pd-2015) $ python weekly_humidity.py
360    77.000000
361    80.428571
362    78.857143
363    78.285714
364    78.714286
Name: Mean Humidity, dtype: float64

</code></pre></div></div>

<p>The End.</p>

<p>Thank you for reading.</p>

